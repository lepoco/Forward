let current_record={id:null,url:null,target:null,name:null,display_name:null};function appendRecordToList(e,r,a,t){jQuery(".records-list__container").prepend('<div class="records-list__record record-'+e+'" data-clipboard-text="'+forward.baseurl+r+'" data-id="'+e+'"><p>/'+r+"</p><span>"+a+"</span><h4>"+t+"</h4></div>")}function pageInstall(){Forward.console("The functions for page Install have been loaded."),jQuery("#input_user_password").on("change paste keyup",function(){let e=jQuery(this).val(),r=zxcvbn(e);""!==e?jQuery(".def_password--strength").html("Strength: <strong>"+{0:"Worst â˜¹",1:"Bad â˜¹",2:"Weak â˜¹",3:"Good ðŸ™ƒ",4:"Strong ðŸ™‚"}[r.score]+"</strong><br/><span class='feedback'>"+r.feedback.warning+" "+r.feedback.suggestions+"</span"):jQuery(".def_password--strength").html("")}),jQuery("#install-forward").on("click",function(e){e.preventDefault(),jQuery("#install-forward").attr("disabled","disabled"),jQuery("#install-form > div, #install-forward, #install-form-alert").fadeOut(200),jQuery("#install-form").slideUp(400,function(){jQuery("#install-progress").slideDown(400)}),jQuery.ajax({url:forward.baseurl,type:"post",data:{action:"setup",input_scriptname:jQuery("#input_scriptname").val(),input_baseuri:jQuery("#input_baseuri").val(),input_db_name:jQuery("#input_db_name").val(),input_db_user:jQuery("#input_db_user").val(),input_db_host:jQuery("#input_db_host").val(),input_db_password:jQuery("#input_db_password").val(),input_user_name:jQuery("#input_user_name").val(),input_user_password:jQuery("#input_user_password").val()},success:function(e){if(console.log(e),Forward.isJson(e)&&null!=e){let r=JSON.parse(e);"error"==r.status?window.setTimeout(function(){jQuery("#install-form, #install-form-alert").hide(),jQuery("#install-form > div, #install-forward, #install-progress").show(),jQuery("#install-form-alert > span").html(r.message),jQuery("#install-progress").slideUp(400,function(){jQuery("#install-forward").removeAttr("disabled"),jQuery("#install-form").slideDown(400,function(e){jQuery("#install-form-alert").slideDown(400)})})},1500):"success"==r.status&&window.setTimeout(function(){jQuery("#install-progress").fadeOut(400,function(){jQuery("#install-done").fadeIn(400),window.setTimeout(function(){window.location.href=jQuery("#input_baseuri").val()+"dashboard"},3e3)})},1e3)}else console.log("error")},fail:function(e,r,a){jQuery("#install-progress").slideUp(400),console.log(e),console.log(r),alert(a)}})})}function pageLogin(){function e(){jQuery("#login-alert").is(":visible")&&jQuery("#login-alert").slideToggle(),jQuery.ajax({url:forward.ajax,type:"post",data:jQuery("#login-form").serialize(),success:function(e){"s01"==e?location.reload():jQuery("#login-alert").slideToggle()},fail:function(e,r,a){jQuery("#login-alert").slideToggle()}})}Forward.console("The functions for page Login have been loaded."),jQuery("#passsword").on("change paste keyup",function(){let e=jQuery(this).val(),r=zxcvbn(e);""!==e?jQuery(".def_password--strength").html("Strength: <strong>"+{0:"Worst â˜¹",1:"Bad â˜¹",2:"Weak â˜¹",3:"Good ðŸ™ƒ",4:"Strong ðŸ™‚"}[r.score]+"</strong><br/><span class='feedback'>"+r.feedback.warning+" "+r.feedback.suggestions+"</span"):jQuery(".def_password--strength").html("")}),jQuery("#button-form").on("click",function(r){r.preventDefault(),e()}),jQuery("#login-form").on("submit",function(r){r.preventDefault(),e()})}jQuery("#show_hide_password a").on("click",function(e){e.preventDefault(),"text"==jQuery("#show_hide_password input").attr("type")?jQuery("#show_hide_password input").attr("type","password"):"password"==jQuery("#show_hide_password input").attr("type")&&jQuery("#show_hide_password input").attr("type","text")}),jQuery(".password_strength_control").each(function(e){let r=jQuery(this).data(),a="def_password--strength";"strengthTarget"in r&&(a=r.strengthTarget),jQuery(this).on("change paste keyup",function(){let e=jQuery(this).val(),r=zxcvbn(e);""!==e?jQuery("."+a).html(Forward.__("strength")+": <strong>"+{0:Forward.__("worst")+" â˜¹",1:Forward.__("bad")+" â˜¹",2:Forward.__("weak")+" â˜¹",3:Forward.__("good")+" ðŸ™ƒ",4:Forward.__("strong")+" ðŸ™‚"}[r.score]+"</strong><br/><span style='display:block;margin-bottom:.8rem;' class='feedback'>"+r.feedback.warning+" "+r.feedback.suggestions+"</span>"):jQuery("."+a).html("")})}),jQuery("table.sortable").each(function(e){jQuery(this).tablesort()}),jQuery(".forward-header__navigation__form").on("submit",function(e){e.preventDefault(),Forward.console("New record via Quick Add");let r=jQuery("#input-record-url").val();Forward.ajax(jQuery(this).serialize(),function(e){if("s01"==e){let e=jQuery("#input-record-slug").val();""==e&&(e=jQuery("#input-rand-value").val()),forward.baseurl,jQuery("#input-record-url").val();let a=new Date;a=a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2),Forward.toast("Success!","New record has been added",6e3,"success"),"dashboard"==forward.pagenow&&appendRecordToList(-1,e,r,0)}else{let r=Forward.__("e1");"e07"==e?r=Forward.__("e7"):"e08"==e?r=Forward.__("e8"):"e10"==e&&(r=Forward.__("e10")),Forward.toast(Forward.__("error_qa"),r,6e3,"alert")}console.log(e)})}),jQuery("#settings-form").on("submit",function(e){e.preventDefault(),Forward.ajax(jQuery(this).serialize(),function(e){"s01"==e?Forward.toast(Forward.__("success"),"The settings have been saved!",6e3,"success"):Forward.toast(Forward.__("error"),"Settings could not be saved!",6e3,"alert"),console.log(e)})}),jQuery("#user-change_password").on("submit",function(e){e.preventDefault(),Forward.ajax(jQuery(this).serialize(),function(e){switch(e){case"s01":jQuery("#input_user_new_password, #input_user_new_password_confirm").val(""),Forward.toast(Forward.__("success"),"User password has been changed",6e3,"success");break;case"e07":Forward.toast(Forward.__("error"),"You must complete all the fields",6e3,"alert");break;case"e12":Forward.toast(Forward.__("error"),"The passwords do not match",6e3,"alert");break;case"e13":Forward.toast(Forward.__("error"),"Password is too short",6e3,"alert");break;default:Forward.toast(Forward.__("error"),"Password update failed. Unknown error.",6e3,"alert")}console.log(e)})}),jQuery("#user-update").on("submit",function(e){e.preventDefault(),Forward.ajax(jQuery(this).serialize(),function(e){"s01"==e?Forward.toast(Forward.__("success"),"User data has been updated",6e3,"success"):Forward.toast(Forward.__("error"),"User data could not be updated!",6e3,"alert"),console.log(e)})}),jQuery("#user-add-form").on("submit",function(e){e.preventDefault(),Forward.ajax(jQuery(this).serialize(),function(e){if("s01"==e)jQuery("#input_user_username, #input_user_display_name, #input_user_email, #input_user_password, #input_user_password_confirm").val(""),Forward.toast(Forward.__("success"),"New user successfully added!",6e3,"success");else{let r="The new user could not be added";switch(e){case"e00":r="E00 - Unknown error";break;case"e05":r="No permission";break;case"e06":r="Missing arguments";break;case"e07":r="Empty arguments";break;case"e12":r="Passwords does not match";break;case"e13":r="Password too short";break;case"e15":r="Invalid email";break;case"e16":r="Username with special characters";break;case"e17":r="User with provided email exists";break;case"e18":r="User with provided username exists";break;case"e19":r="Unknown MySQL error"}Forward.toast(Forward.__("error"),r,6e3,"alert")}console.log(e)})});let clipboard_link=new ClipboardJS(".dashboard__btn--copy-recent");function pageDashboard(){Forward.console("The functions for page Dashboard have been loaded.");let e=Object.keys(records);for(let r=0;r<e.length;r++)appendRecordToList(records[e[r]][0],records[e[r]][4],records[e[r]][5],records[e[r]][1]),r==e.length-1&&l(records[e[r]][0]);clipboard_link.destroy(),clipboard_link=new ClipboardJS(".dashboard__btn--copy-recent"),clipboard_link.on("success",function(e){Forward.toast(Forward.__("success"),"The link has been copied to your clipboard!",3e3,"success")});let r=["#696ffb","#7db8f9","#05478f","#00cccc","#6CA5E0","#1A76CA"],a=null,t=null,o=null,s=null,n=null,d=[];for(let e=0;30>e;e++){let r=new Date;r.setDate(r.getDate()-e),d.push(("0"+r.getDate()).slice(-2)+" "+forward.months_short[r.getMonth()])}function l(e){Forward.ajax({action:"get_record_data",nonce:forward.getrecord,input_record_id:e},function(e){if(Forward.isJson(e)){let d=JSON.parse(e);current_record.id=d.record_id,current_record.url=forward.baseurl+d.record_name,current_record.target=d.record_url,current_record.name=d.record_name,current_record.display_name=d.record_display_name,function(e,d,l,i,u){if(null!=e&&null!=a){let r=Object.keys(e),t=[],o=null;for(let e=0;e<r.length;e++)o=r[e].split("-"),t.push(o[0]+" "+forward.months_short[parseInt(o[1])-1]);let s=[];for(let a=0;a<r.length;a++)s.push(e[r[a]]);a.data.labels=t,a.data.datasets[0].data=s,a.update()}if(null!=d&&null!=t){if(1>d.length)t.data.labels=[Forward.__("nodata")],t.data.datasets[0].data=[1];else{let e=Object.keys(d),r=[];for(let a=0;a<e.length;a++)r.push(d[e[a]]);let a=[];for(let r=0;r<e.length;r++)a.push(Forward.__(forward.visitors.origins[e[r]]));t.data.labels=a,t.data.datasets[0].data=r}t.data.datasets[0].backgroundColor=Forward.shuffle(r),t.update()}if(null!=l&&null!=o){if(1>l.length)o.data.labels=[Forward.__("nodata")],o.data.datasets[0].data=[1];else{let e=Object.keys(l),r=[];for(let a=0;a<e.length;a++)r.push(l[e[a]]);let a=[];for(let r=0;r<e.length;r++)a.push(Forward.__(forward.visitors.languages[e[r]]));o.data.labels=a,o.data.datasets[0].data=r}o.update()}if(null!=i&&null!=s){if(1>i.length)s.data.labels=[Forward.__("nodata")],s.data.datasets[0].data=[1];else{let e=Object.keys(i),r=[];for(let a=0;a<e.length;a++)r.push(i[e[a]]);let a=[];for(let r=0;r<e.length;r++)a.push(Forward.__(forward.visitors.platforms[e[r]]));s.data.labels=a,s.data.datasets[0].data=r}s.update()}if(null!=u&&null!=n){if(1>u.length)n.data.labels=[Forward.__("nodata")],n.data.datasets[0].data=[1];else{let e=Object.keys(u),r=[];for(let a=0;a<e.length;a++)r.push(u[e[a]]);let a=[];for(let r=0;r<e.length;r++)a.push(Forward.__(forward.visitors.agents[e[r]]));n.data.labels=a,n.data.datasets[0].data=r}n.update()}}(d.visitors.days,d.visitors.origins,d.visitors.languages,d.visitors.platforms,d.visitors.agents),jQuery("#ds_record_name").html("/"+d.record_display_name),jQuery("#ds_record_url").html(d.record_url),jQuery("#ds_record_clicks").html(d.record_clicks),jQuery("#ds_archive_name").html("/"+d.record_display_name),jQuery("#ds_archive_target").html(d.record_url),jQuery("#ds_archive_clicks").html(d.record_clicks),jQuery("#ds_archive_action").attr("data-id",d.record_id),jQuery("#ds_record_copy").attr("data-clipboard-text",forward.baseurl+d.record_name),clipboard_link.destroy(),clipboard_link=new ClipboardJS(".dashboard__btn--copy-recent"),clipboard_link.on("success",function(e){Forward.toast(Forward.__("success"),"The link has been copied to your clipboard!",3e3,"success")})}else Forward.toast(Forward.__("error"),"Something went wrong...",6e3,"alert")})}jQuery("#ds_chart_days").length&&(a=new Chart(document.getElementById("ds_chart_days").getContext("2d"),{type:"bar",data:{labels:d.reverse(),datasets:[{label:"# "+Forward.__("of clicks"),data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],backgroundColor:Forward.shuffle(r),borderColor:"transparent"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!0,ticks:{autoSkip:!0,maxTicksLimit:5}},y:{display:!1,min:0}}}})),jQuery("#ds_chart_origins").length&&(t=new Chart(document.getElementById("ds_chart_origins").getContext("2d"),{type:"doughnut",data:{labels:[Forward.__("unknown")],datasets:[{data:[1],backgroundColor:Forward.shuffle(r),borderColor:"transparent",borderWidth:1}]},options:{fill:!0,responsive:!0,maintainAspectRatio:!0,tension:.4,plugins:{legend:{display:!1}}}})),jQuery("#ds_chart_languages").length&&(o=new Chart(document.getElementById("ds_chart_languages").getContext("2d"),{type:"doughnut",data:{labels:[Forward.__("unknown")],datasets:[{data:[1],backgroundColor:Forward.shuffle(r),borderColor:"transparent",borderWidth:1}]},options:{fill:!0,responsive:!0,hover:{mode:"nearest",intersect:!0},tooltips:{mode:"label",position:"nearest",intersect:!0},maintainAspectRatio:!0,tension:.4,plugins:{legend:{display:!1}}}})),jQuery("#ds_chart_platforms").length&&(s=new Chart(document.getElementById("ds_chart_platforms").getContext("2d"),{type:"doughnut",data:{labels:[Forward.__("unknown")],datasets:[{data:[1],backgroundColor:Forward.shuffle(r),borderColor:"transparent",borderWidth:1}]},options:{fill:!0,responsive:!0,maintainAspectRatio:!0,tension:.4,plugins:{legend:{display:!1}}}})),jQuery("#ds_chart_agents").length&&(n=new Chart(document.getElementById("ds_chart_agents").getContext("2d"),{type:"doughnut",data:{labels:[Forward.__("unknown")],datasets:[{data:[1],backgroundColor:Forward.shuffle(r),borderColor:"transparent",borderWidth:1}]},options:{fill:!0,responsive:!0,maintainAspectRatio:!0,tension:.4,plugins:{legend:{display:!1}}}})),jQuery(".records-list__record").on("click",function(e){e.preventDefault();let r=jQuery(this).data();1>r.id||l(r.id)}),jQuery("#ds_archive_action").on("click",function(e){e.preventDefault(),console.log(jQuery(this).data()),console.log("ARCHIVE RECORD");let r=bootstrap.Modal.getInstance(document.getElementById("archiveRecordModal"));r.hide(),Forward.toast(Forward.__("success"),"The link has been archived",6e3,"success")}),jQuery("#ds_record_qrcode").on("click",function(e){let r=new bootstrap.Modal(document.getElementById("qrcodeRecordModal"),{keyboard:!1}),a="#000000ff";jQuery(".forward-app").hasClass("dark-theme")&&(a="#ffffffff"),jQuery("#ds_qrcode_download").attr("download","forward_qrcode_"+current_record.display_name+".png"),QRCode.toDataURL(document.getElementById("ds_qrcode_canvas"),current_record.url,{errorCorrectionLevel:"H",type:"image/png",quality:1,margin:0,scale:10,color:{dark:a,light:"#00000000"}},function(e,a){if(e)return r.hide(),void Forward.toast(Forward.__("error"),e,6e3,"alert");jQuery("#ds_qrcode_download").attr("href",a)}),r.show()}),jQuery(".forward-dashboard__add__form").on("submit",function(e){e.preventDefault(),Forward.console("New record via Standard Add");let r=jQuery("#input-dashboard-record-url").val();Forward.ajax(jQuery(".forward-dashboard__add__form").serialize(),function(e){if("s01"==e){let e=jQuery("#input-dashboard-record-slug").val();""==e&&(e=jQuery("#input-dashboard-rand-value").val()),forward.baseurl,jQuery("#input-record-url").val();let a=new Date;a=a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2),appendRecordToList(-1,e,r,0),Forward.toast(Forward.__("success"),"New record has been added",6e3,"success")}else{let r=Forward.__("e1");"e07"==e?r=Forward.__("e7"):"e08"==e?r=Forward.__("e8"):"e10"==e&&(r=Forward.__("e10")),Forward.toast(Forward.__("error"),r,6e3,"alert")}console.log(e)})})}